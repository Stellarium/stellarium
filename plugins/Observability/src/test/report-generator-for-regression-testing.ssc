// Name: Observability Plugin Report Generator For Regression Testing
// License: Public Domain
// Author: colossatr0n
// Version: 1.0
// Description: Generates reports to be used for regression testing. Run this script in two different versions of Stellarium and compare the output using some kind of differ (vim, git, diff). For macOS, file is output to "~/Library/Application Support/Stellarium/".

const objectNames = [
    "Sun",      // Sun
    "Moon",     // Moon
    "Jupiter",  // Solar system planet
    "Achernar", // Interstellar object
]

// Locations from different continents
const observerLocations = [
    "Boise, Northern America",
    "Brasilia, Southern America",
    "Palestine, Nothern America",
    "Barnaul, Northern Asia",
    "Albany, Australasia",
    "Prague, Eastern Europe"
]

Observability.showReport(true)

core.resetOutput()
var reports = []
for (i=0; i < observerLocations.length; i++) {
    const location = observerLocations[i]
    core.setObserverLocation(location, 0.1)
    for (j=0; j < objectNames.length; j++) {
        const objectName = objectNames[j]
        core.selectObjectByName(objectName)
        const reportJson = Observability.getReportAsJson()
        var reportObj = JSON.parse(reportJson)

        var augmentedReportObj = { objectName: objectName, location: location, report: reportObj }
        reports.push(augmentedReportObj)
    }
}
core.output(JSON.stringify(reports))

const d = new Date()
time = d.getTime()
// For macOS, output will be saved to ~/Library/Application Support/Stellarium/observability-report.json
core.saveOutputAs("observability-report-" + time + ".json")
core.debug("For macOS, output was saved to " + "~/Library/Application\\ Support/Stellarium/observability-report-" + time + ".json")

