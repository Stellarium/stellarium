/*
 * Copyright (C) 2024 Josh Meyers
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335, USA.
 */

#include "StelProjector.hpp"
#include "StelApp.hpp"
#include "StelCore.hpp"
#include "StelLocaleMgr.hpp"
#include "StelModuleMgr.hpp"
#include "MosaicCamera.hpp"
#include "MosaicCameraDialog.hpp"
#include "MosaicTcpServer.hpp"
#include "StelUtils.hpp"
#include "StelPainter.hpp"
#include "CustomObject.hpp"

#include <QDebug>

/*************************************************************************
 This method is the one called automatically by the StelModuleMgr just
 after loading the dynamic library
*************************************************************************/
StelModule* MosaicCameraStelPluginInterface::getStelModule() const
{
	return new MosaicCamera();
}

StelPluginInfo MosaicCameraStelPluginInterface::getPluginInfo() const
{
	StelPluginInfo info;
	info.id = "MosaicCamera";
	info.displayedName = "Mosaic Camera plugin";
	info.authors = "Josh Meyers";
	info.contact = "jmeyers314@gmail.com";
	info.description = "Mosaic Camera Overlay plugin.";
	info.version = MOSAICCAMERA_PLUGIN_VERSION;
	info.license = MOSAICCAMERA_PLUGIN_LICENSE;
	return info;
}

/*************************************************************************
 Constructor
*************************************************************************/
MosaicCamera::MosaicCamera() : ra(0), dec(0), rot(0)
{
	setObjectName("MosaicCamera");
	font.setPixelSize(25);
	configDialog = new MosaicCameraDialog();
    tcpServer = new MosaicTcpServer();
}

/*************************************************************************
 Destructor
*************************************************************************/
MosaicCamera::~MosaicCamera()
{
    delete configDialog;
    delete tcpServer;
}

/*************************************************************************
 Reimplementation of the getCallOrder method
*************************************************************************/
double MosaicCamera::getCallOrder(StelModuleActionName actionName) const
{
	if (actionName==StelModule::ActionDraw)
		return StelApp::getInstance().getModuleMgr().getModule("NebulaMgr")->getCallOrder(actionName)+10.;
	return 0;
}


/*************************************************************************
 Init our module
*************************************************************************/
void MosaicCamera::init()
{
    qDebug() << "\n\n\n\n\n";
	qDebug() << "init called for MosaicCamera";
    qDebug() << "Starting TCP server";
    tcpServer->startServer(5772);
    connect(tcpServer, &MosaicTcpServer::newValuesReceived, this, &MosaicCamera::updateMosaic);
    qDebug() << "\n\n\n\n\n";
}


void MosaicCamera::setRA(double ra)
{
    this->ra = ra;
    if(configDialog->visible()) {
        configDialog->setRA(ra);
    }
}

void MosaicCamera::setDec(double dec)
{
    this->dec = dec;
    if(configDialog->visible()) {
        configDialog->setDec(dec);
    }
}

void MosaicCamera::setRot(double rot)
{
    this->rot = rot;
    if(configDialog->visible()) {
        configDialog->setRot(rot);
    }
}

void MosaicCamera::updateMosaic(double ra, double dec, double rot)
{
    qDebug() << "Received new values: RA=" << ra << ", Dec=" << dec << ", Rot=" << rot;
    setRA(ra);
    setDec(dec);
    setRot(rot);
}

float MosaicCamera::getParallacticAngle() const
{
    Vec3d v;
    StelUtils::spheToRect(ra, dec, v);
    CustomObject obj(QString("test"), v, false);
    float q = obj.getParallacticAngle(StelApp::getInstance().getCore());
    qDebug() << "parallactic angle = " << q;
    return q;
}

void MosaicCamera::draw(StelCore* core)
{
	// Input parameters for drawing LSSTCam FoV should be:
	// altitude
	// azimuth
	// rottelpos
	// Let's start by assuming RTP=0
	// Center at alt=45 az=180
	// Need 12-point star coordinates.
	// Gonna be some projection, but assume rectilinear for current test.

	// const StelProjectorP prj = core->getProjection(StelCore::FrameAltAz);
	const StelProjectorP prj = core->getProjection(StelCore::FrameJ2000);
	// const StelProjectorP prj = core->getProjection(StelCore::FrameEquinoxEqu);
	StelPainter painter(prj);

	std::vector<std::vector<std::vector<Vec2d>>> polygon_sets = {
        {
            {
                {0.01834639524087756, 0.018390984144617213},
                {0.018348563965375937, 0.014422337724567962},
                {0.014468595819035656, 0.014423996515432115},
                {0.014466893578866316, 0.018393109419810403},
            },
            {
                {0.01834862360101588, 0.014297326616356644},
                {0.01835024418533624, 0.010327405350145383},
                {0.014469914605645683, 0.010328588781031817},
                {0.014468642626776773, 0.014298970814159609},
            },
            {
                {0.018350286658806923, 0.0102023599361032},
                {0.018351364887380126, 0.0062315328436198065},
                {0.014470794220642742, 0.00623224515553648},
                {0.014469947942337653, 0.010203528928313284},
            },
            {
                {0.014252727585516255, 0.018393211840565905},
                {0.014254404250569156, 0.014424076454612796},
                {0.010373195550631677, 0.01442531596623177},
                {0.010371979652495306, 0.018394799957636328},
            },
            {
                {0.014254450355028656, 0.014299050050058677},
                {0.014255703222047668, 0.010328645811539366},
                {0.010374137536520715, 0.010329530102731228},
                {0.010373228984782467, 0.014300278656531301},
            },
            {
                {0.014255736057833323, 0.010203585262996875},
                {0.014256569620013483, 0.0062322794822355235},
                {0.010374765823008924, 0.0062328117353223364},
                {0.01037416134816802, 0.010204458764888024},
            },
            {
                {0.01015775488371211, 0.01839487290337595},
                {0.010158945477297968, 0.014425372899280503},
                {0.0062768553411847935, 0.01442619757620982},
                {0.006276121427892352, 0.018395929530573393},
            },
            {
                {0.010158978215624798, 0.014300335088673717},
                {0.010159867858537498, 0.010329570719589712},
                {0.006277423915951641, 0.010330159053409062},
                {0.006276875521843277, 0.014301152509832323},
            },
            {
                {0.010159891174608984, 0.010204498886170692},
                {0.010160483068807747, 0.006232836182421245},
                {0.006277803141585748, 0.006233190296766815},
                {0.006277438288396498, 0.010205080041525774},
            },
            {
                {0.01835139522539771, 0.006082226567808942},
                {0.01835193177960031, 0.0021108551531774647},
                {0.014471239158501572, 0.002111096136705617},
                {0.014470818032167652, 0.0060829217661185885},
            },
            {
                {0.01835194022378369, 0.0019857755364457654},
                {0.01835194022378369, -0.0019857755364457654},
                {0.014471245786086306, -0.001986002236139165},
                {0.014471245786086306, 0.001986002236139165},
            },
            {
                {0.01835193177960031, -0.0021108551531774647},
                {0.01835139522539771, -0.006082226567808942},
                {0.014470818032167652, -0.006082921766118588},
                {0.014471239158501572, -0.002111096136705617},
            },
            {
                {0.014256593073741726, 0.006082955268098344},
                {0.014257007872092066, 0.0021111077497989682},
                {0.010375083628618163, 0.002111287816367708},
                {0.010374782830894679, 0.006083474733427027},
            },
            {
                {0.014257014400087666, 0.0019860131608882836},
                {0.014257014400087666, -0.0019860131608882836},
                {0.010375088362489994, -0.0019861825543446916},
                {0.010375088362489994, 0.0019861825543446916},
            },
            {
                {0.014257007872092066, -0.0021111077497989682},
                {0.014256593073741726, -0.006082955268098343},
                {0.010374782830894679, -0.006083474733427027},
                {0.010375083628618163, -0.002111287816367708},
            },
            {
                {0.010160499722713452, 0.006083498593164215},
                {0.010160794259994917, 0.002111296087048672},
                {0.006277994964096426, 0.0021114158870443253},
                {0.0062778134072951275, 0.006083844199592513},
            },
            {
                {0.010160798895341201, 0.0019861903347961037},
                {0.010160798895341201, -0.0019861903347961037},
                {0.006277997821383259, -0.001986303033862647},
                {0.006277997821383259, 0.001986303033862647},
            },
            {
                {0.010160794259994917, -0.002111296087048672},
                {0.010160499722713452, -0.006083498593164215},
                {0.0062778134072951275, -0.006083844199592512},
                {0.006277994964096426, -0.0021114158870443253},
            },
            {
                {0.018351364887380126, -0.006231532843619808},
                {0.01835028665880692, -0.0102023599361032},
                {0.014469947942337653, -0.010203528928313286},
                {0.014470794220642742, -0.006232245155536482},
            },
            {
                {0.01835024418533624, -0.010327405350145384},
                {0.01834862360101588, -0.014297326616356645},
                {0.014468642626776771, -0.014298970814159609},
                {0.014469914605645683, -0.010328588781031819},
            },
            {
                {0.018348563965375937, -0.014422337724567967},
                {0.01834639524087756, -0.018390984144617217},
                {0.014466893578866316, -0.018393109419810403},
                {0.014468595819035656, -0.014423996515432119},
            },
            {
                {0.014256569620013483, -0.006232279482235525},
                {0.014255736057833323, -0.010203585262996875},
                {0.01037416134816802, -0.010204458764888026},
                {0.010374765823008924, -0.006232811735322338},
            },
            {
                {0.014255703222047668, -0.010328645811539368},
                {0.014254450355028656, -0.014299050050058678},
                {0.01037322898478247, -0.014300278656531305},
                {0.010374137536520717, -0.01032953010273123},
            },
            {
                {0.014254404250569156, -0.0144240764546128},
                {0.014252727585516257, -0.018393211840565908},
                {0.010371979652495306, -0.01839479995763633},
                {0.010373195550631677, -0.014425315966231771},
            },
            {
                {0.010160483068807747, -0.006232836182421247},
                {0.010159891174608984, -0.010204498886170692},
                {0.006277438288396498, -0.010205080041525776},
                {0.006277803141585747, -0.0062331902967668155},
            },
            {
                {0.010159867858537498, -0.010329570719589714},
                {0.010158978215624798, -0.01430033508867372},
                {0.006276875521843276, -0.014301152509832325},
                {0.00627742391595164, -0.010330159053409064},
            },
            {
                {0.010158945477297968, -0.014425372899280507},
                {0.01015775488371211, -0.018394872903375957},
                {0.006276121427892352, -0.018395929530573396},
                {0.006276855341184793, -0.01442619757620982},
            },
            {
                {0.01834630324429571, -0.0185401670710437},
                {0.018343575355022016, -0.02250715118453407},
                {0.014464680187159708, -0.022509768008202775},
                {0.014466821369616143, -0.018542310013847617},
            },
            {
                {0.018343480591644513, -0.022632057842028992},
                {0.018340187157559123, -0.026597002013033385},
                {0.014462020637791272, -0.0266001167637938},
                {0.014464605804237852, -0.02263468972328368},
            },
            {
                {0.018340074410604857, -0.02672183822165426},
                {0.01833620386284607, -0.030684344320173487},
                {0.014458893864271287, -0.030687967926225586},
                {0.014461932136181225, -0.026724968338770333},
            },
            {
                {0.014252656461128542, -0.018542413286083914},
                {0.014250547446155577, -0.022509894119308326},
                {0.010370398612233475, -0.022511849595428866},
                {0.010371928073488725, -0.01854401460661982},
            },
            {
                {0.014250474180658505, -0.022634816560110016},
                {0.014247927848186109, -0.026600266873691495},
                {0.010368498834261481, -0.026602594503908134},
                {0.010370345479436448, -0.022636783289942043},
            },
            {
                {0.014247840675967266, -0.02672511918930413},
                {0.014244848039605362, -0.030688142562809186},
                {0.010366265246585266, -0.030690850547307455},
                {0.010368435614681508, -0.026727458304923533},
            },
            {
                {0.010157704378118132, -0.018544088158849437},
                {0.010156206745839209, -0.02251193941573198},
                {0.006275167103373632, -0.022513240482256426},
                {0.006276090294741015, -0.018545153571375157},
            },
            {
                {0.010156154718742394, -0.022636873627190267},
                {0.010154346501492911, -0.026602701419583603},
                {0.006274020368984192, -0.026604250129442005},
                {0.0062751350318891045, -0.022638182182090898},
            },
            {
                {0.010154284597452403, -0.02672756574820511},
                {0.010152159391313921, -0.030690974935676803},
                {0.006272672117393783, -0.030692776761040205},
                {0.00627398220836615, -0.026729122101052574},
            },
            {
                {0.006037619549417504, 0.018395978113232424},
                {0.00603832549707651, 0.014426235493818407},
                {0.0021557057048326275, 0.014426645870802968},
                {0.002155453971955117, 0.01839650391808566},
            },
            {
                {0.006038344908749775, 0.01430119009382394},
                {0.006038872406166657, 0.010330186104141196},
                {0.0021559007254518506, 0.010330478869776479},
                {0.0021557126267949113, 0.014301596860086078},
            },
            {
                {0.0060388862309433715, 0.010205106762199627},
                {0.006039237181201076, 0.006233206578381133},
                {0.0021560307990007425, 0.006233382791353023},
                {0.0021559056551756824, 0.010205395955651689},
            },
            {
                {0.0019411706044281688, 0.018396518420487337},
                {0.0019413973041215685, 0.01442665718951877},
                {-0.0019413973041215685, 0.01442665718951877},
                {-0.0019411706044281688, 0.018396518420487337},
            },
            {
                {0.0019414035377396204, 0.014301608079212748},
                {0.0019415729311960284, 0.010330486944605442},
                {-0.0019415729311960284, 0.010330486944605442},
                {-0.0019414035377396204, 0.014301608079212748},
            },
            {
                {0.0019415773706903084, 0.010205403931955102},
                {0.0019416900697568516, 0.00623338765151213},
                {-0.0019416900697568516, 0.00623338765151213},
                {-0.0019415773706903084, 0.010205403931955102},
            },
            {
                {-0.002155453971955117, 0.01839650391808566},
                {-0.0021557057048326275, 0.014426645870802968},
                {-0.00603832549707651, 0.014426235493818407},
                {-0.006037619549417504, 0.018395978113232424},
            },
            {
                {-0.0021557126267949113, 0.014301596860086078},
                {-0.0021559007254518506, 0.010330478869776479},
                {-0.006038872406166657, 0.010330186104141196},
                {-0.006038344908749775, 0.01430119009382394},
            },
            {
                {-0.0021559056551756824, 0.010205395955651689},
                {-0.0021560307990007425, 0.006233382791353023},
                {-0.006039237181201076, 0.006233206578381133},
                {-0.0060388862309433715, 0.010205106762199627},
            },
            {
                {0.006039247055728695, 0.006083860090025068},
                {0.0060394216941745, 0.0021114213952493793},
                {0.002156096593543867, 0.00211148100951192},
                {0.0021560343201107073, 0.006084032069300254},
            },
            {
                {0.006039424442582142, 0.0019863082155786456},
                {0.006039424442582142, -0.0019863082155786456},
                {0.002156097573583869, -0.0019863642963111844},
                {0.002156097573583869, 0.0019863642963111844},
            },
            {
                {0.0060394216941745, -0.0021114213952493793},
                {0.006039247055728695, -0.006083860090025068},
                {0.0021560343201107073, -0.006084032069300254},
                {0.002156096593543867, -0.00211148100951192},
            },
            {
                {0.001941693240714674, 0.006084036812688888},
                {0.001941749321447213, 0.0021114826537415496},
                {-0.001941749321447213, 0.0021114826537415496},
                {-0.001941693240714674, 0.006084036812688888},
            },
            {
                {0.0019417502040283943, 0.0019863658430819935},
                {0.0019417502040283943, -0.0019863658430819935},
                {-0.0019417502040283943, -0.0019863658430819935},
                {-0.0019417502040283943, 0.0019863658430819935},
            },
            {
                {0.001941749321447213, -0.0021114826537415496},
                {0.001941693240714674, -0.006084036812688887},
                {-0.001941693240714674, -0.006084036812688887},
                {-0.001941749321447213, -0.0021114826537415496},
            },
            {
                {-0.0021560343201107073, 0.006084032069300254},
                {-0.002156096593543867, 0.00211148100951192},
                {-0.0060394216941745, 0.0021114213952493793},
                {-0.006039247055728695, 0.006083860090025068},
            },
            {
                {-0.002156097573583869, 0.0019863642963111844},
                {-0.002156097573583869, -0.0019863642963111844},
                {-0.006039424442582142, -0.0019863082155786456},
                {-0.006039424442582142, 0.0019863082155786456},
            },
            {
                {-0.002156096593543867, -0.00211148100951192},
                {-0.0021560343201107073, -0.006084032069300254},
                {-0.006039247055728695, -0.006083860090025068},
                {-0.0060394216941745, -0.0021114213952493793},
            },
            {
                {0.006039237181201076, -0.0062332065783811345},
                {0.006038886230943371, -0.010205106762199628},
                {0.0021559056551756824, -0.01020539595565169},
                {0.0021560307990007425, -0.006233382791353025},
            },
            {
                {0.006038872406166657, -0.010330186104141197},
                {0.006038344908749775, -0.014301190093823942},
                {0.0021557126267949113, -0.014301596860086082},
                {0.0021559007254518506, -0.01033047886977648},
            },
            {
                {0.006038325497076511, -0.014426235493818412},
                {0.006037619549417504, -0.018395978113232427},
                {0.0021554539719551165, -0.018396503918085665},
                {0.0021557057048326275, -0.014426645870802971},
            },
            {
                {0.0019416900697568516, -0.0062333876515121315},
                {0.0019415773706903084, -0.010205403931955103},
                {-0.0019415773706903084, -0.010205403931955103},
                {-0.0019416900697568516, -0.0062333876515121315},
            },
            {
                {0.0019415729311960282, -0.010330486944605442},
                {0.0019414035377396206, -0.014301608079212751},
                {-0.0019414035377396206, -0.014301608079212751},
                {-0.0019415729311960282, -0.010330486944605442},
            },
            {
                {0.0019413973041215685, -0.014426657189518771},
                {0.0019411706044281688, -0.01839651842048734},
                {-0.0019411706044281688, -0.01839651842048734},
                {-0.0019413973041215685, -0.014426657189518771},
            },
            {
                {-0.0021560307990007425, -0.006233382791353025},
                {-0.0021559056551756824, -0.01020539595565169},
                {-0.006038886230943371, -0.010205106762199628},
                {-0.006039237181201076, -0.0062332065783811345},
            },
            {
                {-0.0021559007254518506, -0.01033047886977648},
                {-0.0021557126267949113, -0.014301596860086082},
                {-0.006038344908749775, -0.014301190093823942},
                {-0.006038872406166657, -0.010330186104141197},
            },
            {
                {-0.0021557057048326275, -0.014426645870802971},
                {-0.0021554539719551165, -0.018396503918085665},
                {-0.006037619549417504, -0.018395978113232427},
                {-0.006038325497076511, -0.014426235493818412},
            },
            {
                {0.006037589602581689, -0.018545202557986182},
                {0.006036701588751924, -0.022513300304413994},
                {0.0021551266356864573, -0.02251394775553154},
                {0.0021554432932259413, -0.018545732734832468},
            },
            {
                {0.006036670739318462, -0.022638242348573107},
                {0.006035598549106462, -0.026604321338666158},
                {0.0021547332990697627, -0.02660509203457798},
                {0.0021551156350259754, -0.02263889352637273},
            },
            {
                {0.006035561842532645, -0.02672919366171876},
                {0.006034301669772514, -0.030692859609234752},
                {0.0021542708365451546, -0.030693756277955318},
                {0.0021547202096954825, -0.026729968161391053},
            },
            {
                {0.0019411609876278618, -0.01854574735782124},
                {0.0019408758195560653, -0.02251396561316209},
                {-0.0019408758195560653, -0.02251396561316209},
                {-0.0019411609876278618, -0.01854574735782124},
            },
            {
                {0.001940865912836536, -0.0226389114867926},
                {0.0019405215975557696, -0.02660511329156382},
                {-0.0019405215975557696, -0.02660511329156382},
                {-0.001940865912836536, -0.0226389114867926},
            },
            {
                {0.001940509809828239, -0.026729989523293377},
                {0.001940105123644249, -0.030693781009582564},
                {-0.001940105123644249, -0.030693781009582564},
                {-0.001940509809828239, -0.026729989523293377},
            },
            {
                {-0.0021554432932259413, -0.018545732734832468},
                {-0.0021551266356864573, -0.02251394775553154},
                {-0.006036701588751924, -0.022513300304413994},
                {-0.006037589602581689, -0.018545202557986182},
            },
            {
                {-0.0021551156350259754, -0.02263889352637273},
                {-0.0021547332990697627, -0.02660509203457798},
                {-0.006035598549106462, -0.026604321338666158},
                {-0.006036670739318462, -0.022638242348573107},
            },
            {
                {-0.0021547202096954825, -0.026729968161391053},
                {-0.0021542708365451546, -0.030693756277955318},
                {-0.006034301669772514, -0.030692859609234752},
                {-0.006035561842532645, -0.02672919366171876},
            },
            {
                {-0.006272672117393783, 0.03069277676104021},
                {-0.006273982208366151, 0.02672912210105258},
                {-0.010154284597452405, 0.026727565748205118},
                {-0.010152159391313923, 0.03069097493567681},
            },
            {
                {-0.006274020368984192, 0.026604250129442005},
                {-0.0062751350318891045, 0.022638182182090898},
                {-0.010156154718742394, 0.022636873627190267},
                {-0.010154346501492911, 0.026602701419583603},
            },
            {
                {-0.006275167103373631, 0.022513240482256423},
                {-0.006276090294741015, 0.018545153571375154},
                {-0.010157704378118132, 0.018544088158849434},
                {-0.010156206745839209, 0.022511939415731978},
            },
            {
                {-0.010366265246585269, 0.030690850547307462},
                {-0.01036843561468151, 0.026727458304923537},
                {-0.014247840675967268, 0.026725119189304133},
                {-0.014244848039605365, 0.030688142562809193},
            },
            {
                {-0.010368498834261483, 0.026602594503908134},
                {-0.01037034547943645, 0.022636783289942043},
                {-0.014250474180658508, 0.022634816560110016},
                {-0.01424792784818611, 0.026600266873691495},
            },
            {
                {-0.010370398612233475, 0.022511849595428863},
                {-0.010371928073488726, 0.018544014606619818},
                {-0.014252656461128548, 0.01854241328608391},
                {-0.01425054744615558, 0.022509894119308323},
            },
            {
                {-0.014458893864271289, 0.030687967926225593},
                {-0.014461932136181226, 0.026724968338770333},
                {-0.01834007441060486, 0.026721838221654266},
                {-0.018336203862846075, 0.030684344320173494},
            },
            {
                {-0.014462020637791274, 0.0266001167637938},
                {-0.014464605804237855, 0.02263468972328368},
                {-0.018343480591644517, 0.022632057842028992},
                {-0.018340187157559126, 0.02659700201303339},
            },
            {
                {-0.014464680187159712, 0.02250976800820277},
                {-0.014466821369616144, 0.018542310013847617},
                {-0.01834630324429571, 0.0185401670710437},
                {-0.01834357535502202, 0.022507151184534068},
            },
            {
                {-0.006276121427892352, 0.018395929530573393},
                {-0.0062768553411847935, 0.01442619757620982},
                {-0.010158945477297968, 0.014425372899280503},
                {-0.01015775488371211, 0.01839487290337595},
            },
            {
                {-0.006276875521843277, 0.014301152509832323},
                {-0.006277423915951641, 0.010330159053409062},
                {-0.010159867858537498, 0.010329570719589712},
                {-0.010158978215624798, 0.014300335088673717},
            },
            {
                {-0.006277438288396498, 0.010205080041525774},
                {-0.006277803141585748, 0.006233190296766815},
                {-0.010160483068807747, 0.006232836182421245},
                {-0.010159891174608984, 0.010204498886170692},
            },
            {
                {-0.010371979652495308, 0.018394799957636328},
                {-0.010373195550631679, 0.01442531596623177},
                {-0.014254404250569161, 0.014424076454612798},
                {-0.014252727585516258, 0.018393211840565905},
            },
            {
                {-0.01037322898478247, 0.014300278656531303},
                {-0.010374137536520719, 0.010329530102731228},
                {-0.014255703222047672, 0.010328645811539368},
                {-0.014254450355028661, 0.014299050050058677},
            },
            {
                {-0.010374161348168022, 0.010204458764888024},
                {-0.010374765823008924, 0.0062328117353223364},
                {-0.014256569620013487, 0.006232279482235524},
                {-0.014255736057833325, 0.010203585262996875},
            },
            {
                {-0.014466893578866317, 0.018393109419810403},
                {-0.014468595819035658, 0.014423996515432115},
                {-0.01834856396537594, 0.014422337724567963},
                {-0.018346395240877562, 0.018390984144617213},
            },
            {
                {-0.014468642626776773, 0.014298970814159607},
                {-0.014469914605645685, 0.010328588781031817},
                {-0.018350244185336245, 0.010327405350145383},
                {-0.01834862360101588, 0.014297326616356644},
            },
            {
                {-0.014469947942337658, 0.010203528928313284},
                {-0.014470794220642746, 0.006232245155536481},
                {-0.01835136488738013, 0.006231532843619807},
                {-0.018350286658806923, 0.010202359936103198},
            },
            {
                {-0.0062778134072951275, 0.006083844199592513},
                {-0.006277994964096426, 0.0021114158870443253},
                {-0.010160794259994917, 0.002111296087048672},
                {-0.010160499722713452, 0.006083498593164215},
            },
            {
                {-0.006277997821383259, 0.001986303033862647},
                {-0.006277997821383259, -0.001986303033862647},
                {-0.010160798895341201, -0.0019861903347961037},
                {-0.010160798895341201, 0.0019861903347961037},
            },
            {
                {-0.006277994964096426, -0.0021114158870443253},
                {-0.0062778134072951275, -0.006083844199592512},
                {-0.010160499722713452, -0.006083498593164215},
                {-0.010160794259994917, -0.002111296087048672},
            },
            {
                {-0.010374782830894682, 0.006083474733427028},
                {-0.010375083628618165, 0.002111287816367708},
                {-0.014257007872092067, 0.002111107749798968},
                {-0.01425659307374173, 0.006082955268098345},
            },
            {
                {-0.010375088362489994, 0.001986182554344691},
                {-0.010375088362489994, -0.001986182554344691},
                {-0.014257014400087668, -0.0019860131608882836},
                {-0.014257014400087668, 0.0019860131608882836},
            },
            {
                {-0.010375083628618165, -0.002111287816367708},
                {-0.010374782830894682, -0.006083474733427027},
                {-0.01425659307374173, -0.006082955268098344},
                {-0.014257007872092067, -0.002111107749798968},
            },
            {
                {-0.014470818032167656, 0.0060829217661185885},
                {-0.014471239158501575, 0.0021110961367056176},
                {-0.01835193177960031, 0.0021108551531774647},
                {-0.01835139522539771, 0.006082226567808943},
            },
            {
                {-0.01447124578608631, 0.001986002236139165},
                {-0.01447124578608631, -0.001986002236139165},
                {-0.01835194022378369, -0.0019857755364457654},
                {-0.01835194022378369, 0.0019857755364457654},
            },
            {
                {-0.014471239158501575, -0.0021110961367056176},
                {-0.014470818032167656, -0.006082921766118588},
                {-0.01835139522539771, -0.006082226567808942},
                {-0.01835193177960031, -0.0021108551531774647},
            },
            {
                {-0.006277803141585747, -0.0062331902967668155},
                {-0.006277438288396498, -0.010205080041525776},
                {-0.010159891174608984, -0.010204498886170692},
                {-0.010160483068807747, -0.006232836182421247},
            },
            {
                {-0.00627742391595164, -0.010330159053409064},
                {-0.006276875521843276, -0.014301152509832325},
                {-0.010158978215624798, -0.01430033508867372},
                {-0.010159867858537498, -0.010329570719589714},
            },
            {
                {-0.006276855341184793, -0.01442619757620982},
                {-0.006276121427892352, -0.018395929530573396},
                {-0.01015775488371211, -0.018394872903375957},
                {-0.010158945477297968, -0.014425372899280507},
            },
            {
                {-0.010374765823008924, -0.006232811735322337},
                {-0.010374161348168024, -0.010204458764888027},
                {-0.014255736057833326, -0.010203585262996879},
                {-0.014256569620013487, -0.006232279482235525},
            },
            {
                {-0.010374137536520719, -0.01032953010273123},
                {-0.01037322898478247, -0.014300278656531305},
                {-0.014254450355028661, -0.014299050050058678},
                {-0.014255703222047672, -0.010328645811539368},
            },
            {
                {-0.010373195550631679, -0.014425315966231773},
                {-0.010371979652495308, -0.01839479995763633},
                {-0.014252727585516258, -0.018393211840565908},
                {-0.014254404250569157, -0.0144240764546128},
            },
            {
                {-0.014470794220642746, -0.006232245155536483},
                {-0.014469947942337658, -0.010203528928313286},
                {-0.018350286658806923, -0.0102023599361032},
                {-0.01835136488738013, -0.006231532843619808},
            },
            {
                {-0.014469914605645685, -0.010328588781031819},
                {-0.014468642626776773, -0.014298970814159609},
                {-0.01834862360101588, -0.014297326616356645},
                {-0.018350244185336245, -0.010327405350145384},
            },
            {
                {-0.01446859581903566, -0.014423996515432117},
                {-0.014466893578866316, -0.018393109419810403},
                {-0.018346395240877562, -0.018390984144617217},
                {-0.01834856396537594, -0.014422337724567967},
            },
            {
                {-0.006276090294741015, -0.018545153571375157},
                {-0.006275167103373632, -0.022513240482256426},
                {-0.010156206745839209, -0.02251193941573198},
                {-0.010157704378118132, -0.018544088158849437},
            },
            {
                {-0.0062751350318891045, -0.022638182182090898},
                {-0.006274020368984192, -0.026604250129442005},
                {-0.010154346501492911, -0.026602701419583603},
                {-0.010156154718742394, -0.022636873627190267},
            },
            {
                {-0.00627398220836615, -0.026729122101052574},
                {-0.006272672117393783, -0.030692776761040205},
                {-0.010152159391313921, -0.030690974935676803},
                {-0.010154284597452403, -0.02672756574820511},
            },
            {
                {-0.010371928073488726, -0.01854401460661982},
                {-0.010370398612233477, -0.022511849595428866},
                {-0.01425054744615558, -0.02250989411930833},
                {-0.014252656461128548, -0.018542413286083914},
            },
            {
                {-0.01037034547943645, -0.022636783289942043},
                {-0.010368498834261483, -0.026602594503908134},
                {-0.01424792784818611, -0.026600266873691495},
                {-0.014250474180658508, -0.022634816560110016},
            },
            {
                {-0.01036843561468151, -0.026727458304923533},
                {-0.010366265246585267, -0.030690850547307455},
                {-0.014244848039605365, -0.030688142562809186},
                {-0.014247840675967268, -0.02672511918930413},
            },
            {
                {-0.014466821369616144, -0.018542310013847617},
                {-0.014464680187159712, -0.022509768008202775},
                {-0.01834357535502202, -0.02250715118453407},
                {-0.01834630324429571, -0.0185401670710437},
            },
            {
                {-0.014464605804237855, -0.02263468972328368},
                {-0.014462020637791274, -0.0266001167637938},
                {-0.018340187157559126, -0.02659700201303339},
                {-0.018343480591644517, -0.022632057842028992},
            },
            {
                {-0.014461932136181226, -0.02672496833877033},
                {-0.014458893864271289, -0.030687967926225586},
                {-0.018336203862846075, -0.030684344320173487},
                {-0.01834007441060486, -0.02672183822165426},
            },
        },
        {
            {
                {0.03063885551542935, 0.018370137806980696},
                {0.03064253507495745, 0.01442696981174086},
                {0.026772414680591994, 0.014429930304568697},
                {0.026769225259651374, 0.01837392490311697},
            },
            {
                {0.030642655794343027, 0.014278783862683653},
                {0.030645405646122927, 0.010334321482827452},
                {0.026774902797654005, 0.010336434458009844},
                {0.026772519317574853, 0.014281713501161973},
            },
            {
                {0.03064549163316248, 0.010186093974824638},
                {0.030647321386790313, 0.00624071174764212},
                {0.026776563260757096, 0.0062419846303944015},
                {0.026774977327347852, 0.010188176415879269},
            },
            {
                {0.02655148798272046, 0.018374121934540542},
                {0.02655465014479912, 0.014430084327435455},
                {0.022682159197689677, 0.014432603326934718},
                {0.022679476626531546, 0.018377344378115945},
            },
            {
                {0.026554753887388066, 0.014281865918705084},
                {0.02655711699275384, 0.010336544386253045},
                {0.02268425185319307, 0.010338342208209228},
                {0.022682247204727283, 0.014284358662282209},
            },
            {
                {0.026557190885292296, 0.010188284755526902},
                {0.026558763259770232, 0.006242050851900307},
                {0.022685648372504686, 0.0062431338626097255},
                {0.022684314536310732, 0.010190056596115485},
            },
            {
                {0.02246161646315764, 0.018377509983361892},
                {0.02246427232320573, 0.014432732779277415},
                {0.01858979801723113, 0.01443481917378867},
                {0.018587612820146697, 0.018380179093430416},
            },
            {
                {0.02246435945386179, 0.014284486765255492},
                {0.022466344138638492, 0.010338434597798565},
                {0.01859150263319731, 0.01033992363282485},
                {0.018589869705924383, 0.014286551410941156},
            },
            {
                {0.022466406197475777, 0.010190147650494709},
                {0.02246772674903508, 0.0062431895177677745},
                {0.018592640176577992, 0.006244086500686393},
                {0.018591553692467122, 0.01019161516558273},
            },
            {
                {0.030647381248504267, 0.00606823187814247},
                {0.030648291923237782, 0.00212229682261085},
                {0.026777404458888557, 0.002122729159667196},
                {0.02677661514524258, 0.0060694694866976415},
            },
            {
                {0.030648309026149016, 0.001974027872202161},
                {0.030648309241516163, -0.0019720897143643014},
                {0.026777419469178613, -0.001972491443559635},
                {0.026777419282513225, 0.0019744299963251805},
            },
            {
                {0.03064829215479411, -0.00212035866801649},
                {0.030647381911551506, -0.006066293896360982},
                {0.026776615719931344, -0.0060675311086212345},
                {0.026777404659585644, -0.0021207906101199376},
            },
            {
                {0.026558814700644785, 0.006069533873049804},
                {0.026559597265486793, 0.0021227516518162143},
                {0.02268635584639868, 0.0021231194950477802},
                {0.02268569200915486, 0.0060705868707032935},
            },
            {
                {0.026559611962362735, 0.0019744509166575272},
                {0.026559612147432052, -0.0019725123433460175},
                {0.022686368470465408, -0.001972854144583441},
                {0.022686368313474696, 0.001974793053910002},
            },
            {
                {0.026559597464467826, -0.0021208130817216746},
                {0.026558815270419967, -0.00606759547435601},
                {0.0226856924924879, -0.0060686481348222},
                {0.02268635601519045, -0.0021211805889165725},
            },
            {
                {0.022467769951058623, 0.006070640983497113},
                {0.02246842717625845, 0.002123138398170781},
                {0.018593216447504356, 0.0021234430548620438},
                {0.018592675720814588, 0.006071513108246817},
            },
            {
                {0.022468439519155656, 0.0019748106360252013},
                {0.02246843967458265, -0.0019728717094311225},
                {0.018593226730364922, -0.0019731547974704117},
                {0.01859322660248905, 0.0019750940023607736},
            },
            {
                {0.022468427343368975, -0.0021211994747709407},
                {0.022467770429577594, -0.006068702230288045},
                {0.01859267611451346, -0.006069574075764198},
                {0.018593216584992734, -0.0021215038531478985},
            },
            {
                {0.030647322068738457, -0.006238773777225642},
                {0.03064549274888928, -0.010184156352078236},
                {0.02677497829440919, -0.010186238394057794},
                {0.026776563851828358, -0.006240046263594837},
            },
            {
                {0.03064540677821031, -0.010332383876432571},
                {0.03064265736400101, -0.014276846779818974},
                {0.026772520678120054, -0.014279776015061862},
                {0.02677490377889677, -0.010334496452413532},
            },
            {
                {0.030642536661146937, -0.014425032751886285},
                {0.030638857544494608, -0.018368201449554724},
                {0.026769227018463904, -0.01837198813690276},
                {0.026772416055467912, -0.014427992841301899},
            },
            {
                {0.026558763845787866, -0.006240112464478751},
                {0.026557191844086194, -0.010186346712942808},
                {0.0226843153496563, -0.010188118213960417},
                {0.02268564886961623, -0.006241195137925272},
            },
            {
                {0.02655711796560796, -0.01033460635988751},
                {0.026554755236303844, -0.014279928411625018},
                {0.022682248349040552, -0.014282420812064121},
                {0.02268425267846654, -0.010336403842164383},
            },
            {
                {0.026554651507923202, -0.01442814684317947},
                {0.026551489726502623, -0.0183721851470563},
                {0.022679478105864428, -0.01837540724273277},
                {0.022682160354057308, -0.014430665499389136},
            },
            {
                {0.022467727241195338, -0.006241250775751449},
                {0.022466407002720967, -0.010188209250888737},
                {0.018591554354987088, -0.010189676484716014},
                {0.018592640581500324, -0.006242147479333494},
            },
            {
                {0.02246634495569282, -0.010336496214297226},
                {0.022464360586779863, -0.01428254889740254},
                {0.018589870638057625, -0.01428461325885373},
                {0.018591503305433722, -0.010337984967972454},
            },
            {
                {0.022464273468058182, -0.014430794934089154},
                {0.02246161792776154, -0.018375572830098323},
                {0.018587614025213563, -0.018378241651963348},
                {0.018589798959184445, -0.01443288104423957},
            },
            {
                {0.018335246837711813, 0.03067370735367386},
                {0.01833909462960039, 0.02673441936123189},
                {0.0144648293852087, 0.026737548086420215},
                {0.01446180819662856, 0.03067732621744965},
            },
            {
                {0.01833922835060963, 0.026586357828155792},
                {0.018342502439266096, 0.022644645962879233},
                {0.014467505022236753, 0.022647276888956302},
                {0.01446493437765643, 0.02658946834515339},
            },
            {
                {0.018342614831965764, 0.022496500870738106},
                {0.01834532671831066, 0.018552760931441727},
                {0.014469722436555916, 0.018554903352249786},
                {0.01446759326576829, 0.02249911395450982},
            },
            {
                {0.01424388812250003, 0.030677503961267668},
                {0.014246863120077518, 0.026737701753822108},
                {0.010371336234152125, 0.02674003987480209},
                {0.010369177899870564, 0.030680208453948397},
            },
            {
                {0.014246966507201598, 0.026589621118161367},
                {0.014249497844927848, 0.022647406104805062},
                {0.010373247655671368, 0.02264937215912172},
                {0.010371411239566062, 0.026591945629378014},
            },
            {
                {0.014249584739089974, 0.022499242293977043},
                {0.01425168135044448, 0.018555008574077093},
                {0.010374831694949025, 0.018556609535681185},
                {0.0103733106942539, 0.022501195013084903},
            },
            {
                {0.010151196705096106, 0.03068033505887294},
                {0.010153309327765812, 0.0267401493273252},
                {0.00627688590403686, 0.02674170507911937},
                {0.0062755828396695, 0.03068213463088569},
            },
            {
                {0.010153382744584183, 0.02659205444474573},
                {0.010155180264859709, 0.022649464193246194},
                {0.0062780398774663695, 0.0226507723497532},
                {0.006276931187070007, 0.026593601139536724},
            },
            {
                {0.010155241968232129, 0.022501286422928996},
                {0.010156730752151913, 0.01855668447844479},
                {0.0062789961868628995, 0.018557749693723893},
                {0.006278077935112515, 0.022502585705656535},
            },
            {
                {0.0060333363116887185, 0.03068221880833412},
                {0.006034588941627878, 0.026741777850869446},
                {0.0021576267151363015, 0.026742552143131437},
                {0.002157179356695969, 0.030683114461683644},
            },
            {
                {0.006034632471986048, 0.02659367348761343},
                {0.006035698250239919, 0.022650833539488553},
                {0.00215802288512689, 0.022651484596131987},
                {0.0021576422612949423, 0.026594443271855055},
            },
            {
                {0.006035734834841532, 0.022502646480299014},
                {0.006036617544815552, 0.018557799519397636},
                {0.0021583511925329793, 0.01855832966086309},
                {0.0021580359506173995, 0.022503293120274524},
            },
            {
                {0.001939137212643717, 0.030683139643540913},
                {0.001939539340319162, 0.026742573912746478},
                {-0.0019376007835310988, 0.026742574095859437},
                {-0.0019371990578881918, 0.03068313985535564},
            },
            {
                {0.0019395533146611321, 0.02659446491472138},
                {0.0019398954549360936, 0.022651502900840493},
                {-0.001937956542116954, 0.022651503054808717},
                {-0.001937614743902017, 0.026594465096768206},
            },
            {
                {0.0019399071994188023, 0.02250331130080422},
                {0.0019401905682576665, 0.0185583445659429},
                {-0.0019382513603939206, 0.018558344691315475},
                {-0.0019379682748579237, 0.02250331145372793},
            },
            {
                {-0.002155241206710655, 0.030683114697334868},
                {-0.0021556881630807045, 0.02674255234685101},
                {-0.0060326505579988265, 0.02674177842146331},
                {-0.006031398331471972, 0.030682219468358862},
            },
            {
                {-0.0021557036952669774, 0.026594443474388513},
                {-0.0021560839770065387, 0.022651484767427055},
                {-0.006033759509348653, 0.02265083401926916},
                {-0.006032694074337801, 0.02659367405488532},
            },
            {
                {-0.002156097030754195, 0.02250329329040754},
                {-0.002156411989339928, 0.018558329800344525},
                {-0.0060346785078527, 0.018557799910074016},
                {-0.006033796082167774, 0.022502646956824926},
            },
            {
                {-0.018585675405727257, 0.018380180298497976},
                {-0.01858786036934203, 0.014434820115755859},
                {-0.02246233552440618, 0.01443273392415673},
                {-0.02245967990167046, 0.018377511447979427},
            },
            {
                {-0.018587932050375528, 0.014286552343088775},
                {-0.018589564803166786, 0.010339924305088859},
                {-0.02246440715468765, 0.010338435414893578},
                {-0.022462422647276128, 0.014284487898200927},
            },
            {
                {-0.018589615856980574, 0.01019161582813079},
                {-0.01859070222499006, 0.006244086905650151},
                {-0.022465789641512204, 0.006243190009982679},
                {-0.022464469207978587, 0.010190148455781088},
            },
            {
                {-0.022677540118066726, 0.018377345857463194},
                {-0.022680222451674774, 0.014432604483329947},
                {-0.026552714428257587, 0.014430085690600222},
                {-0.02654955250833844, 0.01837412367835007},
            },
            {
                {-0.02268031045091844, 0.014284359806623573},
                {-0.022682314921840672, 0.010338343033524116},
                {-0.02655518108726439, 0.010336545359161821},
                {-0.02655281816290102, 0.014281867267662044},
            },
            {
                {-0.022682377599406403, 0.010190057409502976},
                {-0.022683711317455627, 0.006243134359776667},
                {-0.026556827228167525, 0.006242051437986746},
                {-0.02655525497414257, 0.01018828571437595},
            },
            {
                {-0.026767289848640255, 0.01837392666195759},
                {-0.026770479027140515, 0.014429931679486035},
                {-0.030640600637332264, 0.014426971397984992},
                {-0.03063692132562069, 0.018370139836087134},
            },
            {
                {-0.026770583656168627, 0.014281714861749095},
                {-0.02677296695503463, 0.010336435439308006},
                {-0.030643471015118866, 0.010334322614983644},
                {-0.030640721348586298, 0.014278785432396796},
            },
            {
                {-0.026773041479061604, 0.01018817738299651},
                {-0.026774627291877223, 0.006241985221535234},
                {-0.030645386626707172, 0.006240712429673482},
                {-0.030643556996365187, 0.010186095090620758},
            },
            {
                {-0.018590737765428304, 0.006071513501987693},
                {-0.01859127843433367, 0.0021234431924059003},
                {-0.02246649000613036, 0.0021231385653501978},
                {-0.022465832839674363, 0.006070641462071325},
            },
            {
                {-0.018591288588233147, 0.0019750941302926314},
                {-0.01859128871609535, -0.001973154925276626},
                {-0.022466502503337416, -0.001972871864774818},
                {-0.02246650234792431, 0.0019748107915216113},
            },
            {
                {-0.018591278571807354, -0.0021215039905661042},
                {-0.018590738159085102, -0.006069574469378988},
                {-0.022465833318150562, -0.006068702708709006},
                {-0.022466490173225946, -0.0021211996417976335},
            },
            {
                {-0.022683754950240522, 0.0060705873540923185},
                {-0.022684418728681148, 0.002123119663909215},
                {-0.026557661169989148, 0.0021227518508805518},
                {-0.02655687866510118, 0.006069534442894399},
            },
            {
                {-0.022684431194652802, 0.001974793210970886},
                {-0.02268443135162961, -0.0019728543014900742},
                {-0.02655767605079424, -0.0019725125283173205},
                {-0.026557675865739105, 0.0019744511018106705},
            },
            {
                {-0.022684418897457977, -0.002121180757623747},
                {-0.022683755433530742, -0.006068648618056432},
                {-0.026556879234832718, -0.0060675960440181335},
                {-0.026557661368954936, -0.00212081328060416},
            },
            {
                {-0.026774679172417208, 0.006069470061456581},
                {-0.026775468426039024, 0.002122729360448359},
                {-0.030646357097754515, 0.002122297054265191},
                {-0.03064544648438746, 0.006068232541273535},
            },
            {
                {-0.026775483248536378, 0.001974430183075174},
                {-0.02677548343518757, -0.0019724916301262197},
                {-0.03064637441486585, -0.001972089929618391},
                {-0.030646374199513212, 0.0019740280876678605},
            },
            {
                {-0.026775468626720852, -0.002120790810717681},
                {-0.026774679747062272, -0.0060675316831961265},
                {-0.03064544714739002, -0.006066294559279709},
                {-0.030646357329295243, -0.0021203588994592078},
            },
            {
                {-0.018590702629869126, -0.00624214788417114},
                {-0.018589616519429746, -0.010189677147137094},
                {-0.022464470013151813, -0.01018821005602078},
                {-0.022465790133628472, -0.006241251267813071},
            },
            {
                {-0.018589565475331367, -0.010337985640109437},
                {-0.01858793298240918, -0.014284614190873018},
                {-0.022462423780092954, -0.014282550030192012},
                {-0.02246440797166896, -0.010336497031237856},
            },
            {
                {-0.018587861311194703, -0.01443288198607837},
                {-0.018585676610665382, -0.018378242856900782},
                {-0.022459681366143496, -0.018375574294557724},
                {-0.02246233666915633, -0.014430796078812437},
            },
            {
                {-0.02268371181452314, -0.006241195634937388},
                {-0.022682378412679928, -0.010188119027192018},
                {-0.026555255932863016, -0.010186347671608099},
                {-0.026556827814140257, -0.006240113050382677},
            },
            {
                {-0.02268231574704105, -0.010336404667323334},
                {-0.022680311595130367, -0.014282421956247956},
                {-0.026552819511713486, -0.014279929760396298},
                {-0.026555182060043994, -0.010334607332612471},
            },
            {
                {-0.022680223607939993, -0.014430666655626763},
                {-0.022677541597268615, -0.018375408721920294},
                {-0.02654955425198708, -0.01837218689067758},
                {-0.026552715791277274, -0.014428148206158474},
            },
            {
                {-0.02677462788290354, -0.006240046854551585},
                {-0.02677304244604941, -0.010186239360989693},
                {-0.030643558112016807, -0.010184157467660531},
                {-0.030645387308609374, -0.006238774459044622},
            },
            {
                {-0.02677296793620279, -0.010334497433526295},
                {-0.02677058501661039, -0.014279777375461702},
                {-0.030640722918138553, -0.014276848349316074},
                {-0.030643472147129983, -0.010332385008374873},
            },
            {
                {-0.026770480401911913, -0.014427994216031874},
                {-0.0267672916073191, -0.018371989895553505},
                {-0.030636923354549307, -0.018368203478442157},
                {-0.030640602223414908, -0.014425034337914278},
            },
        },
        {
            {
                {0.027044781862091364, 0.018626414020815534},
                {0.023103362294895458, 0.018629805503367392},
                {0.02309997585202849, 0.02250307224345223},
                {0.027040789583676325, 0.02249895225902746},
            },
            {
                {0.018629807032689596, 0.023101425908454556},
                {0.01862641582377898, 0.027042846549750164},
                {0.022498954449231872, 0.0270388545719163},
                {0.0225030741013136, 0.023098039760281283},
            },
            {
                {0.018626414020815534, -0.027044781862091364},
                {0.018629805503367396, -0.023103362294895458},
                {0.02250307224345223, -0.023099975852028495},
                {0.02249895225902746, -0.027040789583676325},
            },
            {
                {0.023101425908454553, -0.018629807032689596},
                {0.027042846549750168, -0.01862641582377898},
                {0.027038854571916307, -0.022498954449231875},
                {0.023098039760281283, -0.0225030741013136},
            },
            {
                {-0.018626414020815534, 0.027044781862091364},
                {-0.018629805503367396, 0.023103362294895458},
                {-0.02250307224345223, 0.023099975852028495},
                {-0.02249895225902746, 0.027040789583676325},
            },
            {
                {-0.023101425908454553, 0.018629807032689596},
                {-0.027042846549750168, 0.01862641582377898},
                {-0.027038854571916307, 0.022498954449231875},
                {-0.023098039760281283, 0.0225030741013136},
            },
            {
                {-0.027044781862091364, -0.018626414020815534},
                {-0.023103362294895454, -0.018629805503367396},
                {-0.023099975852028495, -0.02250307224345223},
                {-0.027040789583676325, -0.02249895225902746},
            },
            {
                {-0.018629807032689596, -0.023101425908454556},
                {-0.01862641582377898, -0.027042846549750164},
                {-0.022498954449231872, -0.0270388545719163},
                {-0.0225030741013136, -0.023098039760281283},
            },
        },
        {
            {
                {0.018670176093765572, 0.018792792570979773},
                {0.01866738165634269, 0.02273637949577133},
                {0.020604253071233102, 0.022734791856225036},
                {0.020607345912494586, 0.01879148802066858},
            },
            {
                {0.02285725581737714, 0.0227346773210379},
                {0.022860699271749618, 0.018791739995303862},
                {0.020924032152459315, 0.018793199316126},
                {0.02092088999384325, 0.02273645325221995},
            },
            {
                {0.018792792570979773, -0.018670176093765572},
                {0.02273637949577133, -0.01866738165634269},
                {0.022734791856225036, -0.020604253071233102},
                {0.01879148802066858, -0.020607345912494586},
            },
            {
                {0.0227346773210379, -0.02285725581737714},
                {0.01879173999530386, -0.02286069927174962},
                {0.018793199316126, -0.020924032152459318},
                {0.02273645325221995, -0.02092088999384325},
            },
            {
                {-0.018792792570979773, 0.018670176093765572},
                {-0.02273637949577133, 0.01866738165634269},
                {-0.022734791856225036, 0.020604253071233102},
                {-0.01879148802066858, 0.020607345912494586},
            },
            {
                {-0.0227346773210379, 0.02285725581737714},
                {-0.018791739995303862, 0.022860699271749618},
                {-0.018793199316126, 0.020924032152459315},
                {-0.02273645325221995, 0.02092088999384325},
            },
            {
                {-0.018670176093765572, -0.018792792570979773},
                {-0.01866738165634269, -0.02273637949577133},
                {-0.020604253071233102, -0.022734791856225036},
                {-0.020607345912494586, -0.01879148802066858},
            },
            {
                {-0.02285725581737714, -0.0227346773210379},
                {-0.022860699271749618, -0.018791739995303862},
                {-0.020924032152459315, -0.018793199316126},
                {-0.02092088999384325, -0.02273645325221995},
            },
        },
        {
            {
                {0.006039247055728695, 0.006083860090025068},
                {0.0060394216941745, 0.0021114213952493793},
                {0.002156096593543867, 0.00211148100951192},
                {0.0021560343201107073, 0.006084032069300254},
            },
            {
                {0.006039424442582142, 0.0019863082155786456},
                {0.006039424442582142, -0.0019863082155786456},
                {0.002156097573583869, -0.0019863642963111844},
                {0.002156097573583869, 0.0019863642963111844},
            },
            {
                {0.0060394216941745, -0.0021114213952493793},
                {0.006039247055728695, -0.006083860090025068},
                {0.0021560343201107073, -0.006084032069300254},
                {0.002156096593543867, -0.00211148100951192},
            },
            {
                {0.001941693240714674, 0.006084036812688888},
                {0.001941749321447213, 0.0021114826537415496},
                {-0.001941749321447213, 0.0021114826537415496},
                {-0.001941693240714674, 0.006084036812688888},
            },
            {
                {0.0019417502040283943, 0.0019863658430819935},
                {0.0019417502040283943, -0.0019863658430819935},
                {-0.0019417502040283943, -0.0019863658430819935},
                {-0.0019417502040283943, 0.0019863658430819935},
            },
            {
                {0.001941749321447213, -0.0021114826537415496},
                {0.001941693240714674, -0.006084036812688887},
                {-0.001941693240714674, -0.006084036812688887},
                {-0.001941749321447213, -0.0021114826537415496},
            },
            {
                {-0.0021560343201107073, 0.006084032069300254},
                {-0.002156096593543867, 0.00211148100951192},
                {-0.0060394216941745, 0.0021114213952493793},
                {-0.006039247055728695, 0.006083860090025068},
            },
            {
                {-0.002156097573583869, 0.0019863642963111844},
                {-0.002156097573583869, -0.0019863642963111844},
                {-0.006039424442582142, -0.0019863082155786456},
                {-0.006039424442582142, 0.0019863082155786456},
            },
            {
                {-0.002156096593543867, -0.00211148100951192},
                {-0.0021560343201107073, -0.006084032069300254},
                {-0.006039247055728695, -0.006083860090025068},
                {-0.0060394216941745, -0.0021114213952493793},
            },
        },
    };

    std::vector<std::vector<float>> colors = {
        {0.0, 0.3, 1.0, 1.0},    // E2V = BLUE
        {0.0, 0.7, 1.0, 1.0},    // ITL = Cyan
        {0.0, 1.0, 0.0, 1.0},    // Guider = Green
        {1.0, 0.0, 0.0, 1.0},    // WF = Red
        {1.0, 1.0, 1.0, 1.0},    // ComCam = White
    };

    double alpha = ra / 57.29577951308232 + 1.5707963267948966;  // ra=0 isn't along x=0?
    double beta = 1.5707963267948966 - dec / 57.29577951308232;  // polar angle
    double rtp = rot / 57.29577951308232;  // rotation wrt current North
    double rsp = rtp + getParallacticAngle();
    qDebug() << "rsp = " << rsp;
    qDebug() << "rtp = " << rtp;

    double cosBeta = cos(beta);
    double sinBeta = sin(beta);

    double cosAlpha = cos(alpha);
    double sinAlpha = sin(alpha);

	Vec3d startPoint, endPoint;

    for (size_t iset=0; iset<polygon_sets.size(); ++iset) {
        const auto& polygons = polygon_sets[iset];
        painter.setColor(
            colors[iset][0],
            colors[iset][1],
            colors[iset][2],
            colors[iset][3]
        );
        for (const auto& polygon : polygons) {
            // Loop through points in the polygon
            for (size_t i = 0; i < polygon.size(); ++i) {
                const Vec2d& p1 = polygon[i];
                const Vec2d& p2 = polygon[(i + 1) % polygon.size()];

                // Apply camera rotator

                double r1x = cos(rsp) * p1[0] + sin(rsp) * p1[1];
                double r1y = -sin(rsp) * p1[0] + cos(rsp) * p1[1];
                double r2x = cos(rsp) * p2[0] + sin(rsp) * p2[1];
                double r2y = -sin(rsp) * p2[0] + cos(rsp) * p2[1];

                double r1z = 1.0;
                double r2z = 1.0;

                double den1 = sqrt(r1x*r1x + r1y*r1y + r1z*r1z);
                double den2 = sqrt(r2x*r2x + r2y*r2y + r2z*r2z);

                // Apply declination

                double s1x = r1x;
                double s1y = r1y * cosBeta - r1z * sinBeta;
                double s1z = r1y * sinBeta + r1z * cosBeta;
                double s2x = r2x;
                double s2y = r2y * cosBeta - r2z * sinBeta;
                double s2z = r2y * sinBeta + r2z * cosBeta;

                // Apply right ascension

                startPoint.set(
                    (s1x*cosAlpha - s1y*sinAlpha)/den1,
                    (s1x*sinAlpha + s1y*cosAlpha)/den1,
                    s1z/den1
                );
                endPoint.set(
                    (s2x*cosAlpha - s2y*sinAlpha)/den2,
                    (s2x*sinAlpha + s2y*cosAlpha)/den2,
                    s2z/den2
                );

                painter.drawGreatCircleArc(startPoint, endPoint);
            }
        }
    }
}

bool MosaicCamera::configureGui(bool show)
{
	if (show)
		configDialog->setVisible(true);
	return true;
}
