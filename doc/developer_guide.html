<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Stellarium Developer guide v 0.2</TITLE>
<META NAME="description" CONTENT="Stellarium Developer guide v 0.2">
<META NAME="keywords" CONTENT="developer_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="developer_guide.css">

</HEAD>

<BODY >

<P>
<H1 ALIGN="CENTER"><B>Stellarium Developer guide</B> 
<BR>
v 0.2</H1>
<DIV>

<P ALIGN="CENTER"><STRONG>Fabien Ch&#233;reau</STRONG></P>
</DIV>

<P>

<H3>Abstract:</H3>
<DIV>
This document is aimed at giving a global vision on the organization of the program source code.
</DIV>
<P>

<P>

<H1><A NAME="SECTION00010000000000000000">
Introduction</A>
</H1>
Stellarium is almost totally designed in an object oriented way. Its source code is thus quite easy to understand and is well subdivided.
The interface with the OS is done using the SDL library which has proven to be powerfull, truly multiplateform and fast.
Project managment is done using sourceforge.net services for cvs hosting, bug tracking, forums etc.. Globally, everything usefull for the project is available at the main project page <A NAME="tex2html1"
  HREF="http://sourceforge.net/projects/stellarium/">http://sourceforge.net/projects/stellarium/</A>.

<P>

<H1><A NAME="SECTION00020000000000000000">
I want to contribute in developing stellarium. How to start?</A>
</H1>
First of all, as stellarium is mainly programmed in C++ you will need some knowledge in object oriented programming.
You will then need to use the GNU development tools and utilities that are required for working on free projects.

<P>
Stellarium source code is stored on sourceforge.net server using cvs (concurent version system). This enable everybody to download the last changes in the sources. The cvs version of stellarium is usually on development and might not work at all.

<P>
Here are the first steps to start working on the sourcecode : (see detailed instructions from <A NAME="tex2html2"
  HREF="http://sourceforge.net/cvs/?group_id=48857">sourceforge cvs page</A>)
In the stellarium cvs repository, there is only one module called "stellarium"
containing all the project files. So, to get the files as anonymous developer, just type (as explained) :

<P>
<TT>cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/stellarium login</TT>

<P>
and type <TT>enter</TT> when a password is required.

<P>
<TT>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/stellarium co stellarium</TT>

<P>
(co = checkout)
And normally all the project files should be downloaded in a new <TT>stellarium/</TT> directory.
In this directory you will find the script <TT>autogen.sh</TT> that you need to execute in
order to run the automake/autoconf things.
After that you can launch the <TT>./configure</TT> script which will analyze your system.
If everything goes fine, the command <TT>make</TT> should then compile all the sourcecode.

<P>
You can now try to launch the local version by typing <TT>./src/stellarium</TT>

<P>
Here you are!

<P>
You can now have a look at the <TT>src/</TT> directory where you will find the source files described below.
Edit whatever you want in it and when your new great feature is done you will need to share it with the community of stellarium developers.

<P>
At this point, an official developer just have to type <TT>cvs commit</TT> to update the repository version. But as you are not an official developer (yet!) you will need to create a patch file which will contain all the changes you did on the source code.

<P>
<TT>cd directory-you-want-to-diff</TT>

<P>
<TT>cvs -z3 diff -u &gt; mypatch.diff</TT>

<P>
You can now submit mypatch.diff on the sourceforge stellarium page in the <A NAME="tex2html3"
  HREF="http://sourceforge.net/tracker/?group_id=48857&amp;atid=454375">patches section</A>
with a clear comment on what is the patch doing.

<P>
The project administrator will then have a look at it and decide whether the patch is accepted or rejected for integration into stellarium.

<P>

<H1><A NAME="SECTION00030000000000000000">
Main files description</A>
</H1>
All the files starting with a s_ are "theoricaly" independent of the main program. They manage textures, font and user interface and could be re-used for any other openGL application.

<P>
<DL>
<DT><STRONG>stel_sdl.h/cpp :</STRONG></DT>
<DD>Class handling sdl functions. It contains the main loop intercepting all the system events and send them to the core.
	
</DD>
<DT><STRONG>stel_core.h/cpp :</STRONG></DT>
<DD>Main stellarium class. It manages all the main components of the program and stores all the attributes of the program.
The 3 main functions of the program are methods of his class. They are :
	<DL>
<DT><STRONG>init() :</STRONG></DT>
<DD>Initialize the core of the program : creates all the main objects and initialize them.
		
</DD>
<DT><STRONG>update() :</STRONG></DT>
<DD>Update all the objects : time, viewing, planet positions, moves, user interface etc..
		
</DD>
<DT><STRONG>draw() :</STRONG></DT>
<DD>Draw everything on the openGL buffer.
	
</DD>
</DL>
update() and draw() are called in the main loop at each iteration.
The stel_core class manages all the configuration file reading and saving.

<P>
</DD>
<DT><STRONG>navigator.h/cpp :</STRONG></DT>
<DD>Manage all the astronomical navigational functions. Used for frames conversions.

<P>
</DD>
<DT><STRONG>observator.h/cpp :</STRONG></DT>
<DD>Manage all the information relative to an observator (position, locales etc..)

<P>
</DD>
<DT><STRONG>projector.h/cpp and fisheye_projector.h/cpp :</STRONG></DT>
<DD>One of the class i'm proud of :). Manage various kind of projections : perspective, fisheye.

<P>
</DD>
<DT><STRONG>init_parser.h/cpp :</STRONG></DT>
<DD>Wrapper c++ class for the c library initparser.

<P>
</DD>
<DT><STRONG>stel_object.h/cpp :</STRONG></DT>
<DD>Abstract mother class for all astronomical objects stars, planets and nebula.

<P>
</DD>
<DT><STRONG>hip_star.h/cpp and hip_star_mgr.h/cpp :</STRONG></DT>
<DD>Manage stars from the hipparcos catalog and stars collections respectively.

<P>
</DD>
<DT><STRONG>grid.h/cpp :</STRONG></DT>
<DD>Used for optimization with grid structure while displaying the hipparcos star catalog.

<P>
</DD>
<DT><STRONG>planet.h/cpp and solarsystem.h/cpp :</STRONG></DT>
<DD>Manage any body which has a defined position inside the solar system.

<P>
</DD>
<DT><STRONG>nebula.h/cpp and nebula_mgr.h/cpp :</STRONG></DT>
<DD>Manage nebula and nebula collection repectively.

<P>
</DD>
<DT><STRONG>constellation.h/cpp and constellation_mgr.h/cpp :</STRONG></DT>
<DD>Manage constellations and collection of constellations respectively.

<P>
</DD>
<DT><STRONG>landscape.h/cpp :</STRONG></DT>
<DD>Manage landscapes.

<P>
</DD>
<DT><STRONG>stel_atmosphere.h/cpp :</STRONG></DT>
<DD>Manage atmosphere rendering. Uses the classes sky_bright and sky_light to compute sky color and brightness and display it.

<P>
</DD>
<DT><STRONG>tone_reproductor.h/cpp :</STRONG></DT>
<DD>The class which simulate the eye adaptation to luminance.

<P>
</DD>
<DT><STRONG>draw.h/cpp :</STRONG></DT>
<DD>Groups some classes used to draw various objects of the program : milky way, grids, astronomical lines, cardinal points.

<P>
</DD>
<DT><STRONG>stel_ui.h/cpp :</STRONG></DT>
<DD>manage the user interface for stellarium using s_gui/s_tui widgets.

<P>
</DD>
<DT><STRONG>s_gui.h/cpp :</STRONG></DT>
<DD>All the Graphical User Interface (gui) classes. Used in the desktop version only.

<P>
</DD>
<DT><STRONG>s_tui.h/cpp :</STRONG></DT>
<DD>All the Text User Interface (tui) classes. Used in planetarium version only.

<P>
</DD>
<DT><STRONG>s_font.h/cpp :</STRONG></DT>
<DD>Manage fonts. The font in stellarium are not bitmap but taken from a real grey level texture.

<P>
</DD>
<DT><STRONG>s_texture.h/cpp :</STRONG></DT>
<DD>Class which manages textures. Currently uses glpng library to handle png files.

<P>
</DD>
<DT><STRONG>callback.h/cpp :</STRONG></DT>
<DD>Handfull class made by the boost library team used to handle callbacks. It's used for the widgets.
</DD>
</DL>

<P>

<H1><A NAME="SECTION00040000000000000000">
External libraries (directories in src/)</A>
</H1>
<DL>
<DT><STRONG>glpng :</STRONG></DT>
<DD>create openGL textures from .png files. Written in C and used thru the s_texture class.
	
</DD>
<DT><STRONG>iniparser :</STRONG></DT>
<DD>config files parsing. Used thru the wrapper class init_parser.
	
</DD>
<DT><STRONG>stellastro :</STRONG></DT>
<DD>miscelaneous astronomical functions.
	
</DD>
<DT><STRONG>stellplanet :</STRONG></DT>
<DD>compute heliocentric positions of solar system planets.
</DD>
</DL>

<P>

<H1><A NAME="SECTION00050000000000000000">
Stellarium data files format specification</A>
</H1>

<P>

<UL>
<LI>commonname.fab and name.fab

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Contains the commonly used stars names.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ascii file, fields separated by <IMG
 WIDTH="9" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$"> (pipe), end of line is CR ('<IMG
 WIDTH="13" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\backslash$">n')
</DD>
<DT><STRONG>line example :</STRONG></DT>
<DD>62956<IMG
 WIDTH="9" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$">Alioth
</DD>
<DT><STRONG>line format :</STRONG></DT>
<DD>HPnum<IMG
 WIDTH="9" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$">Star_Name
	
<UL>
<LI>HPnum : (unsigned int) Hipparcos catalog star number
</LI>
<LI>Star_Name : (string) The name string without spaces. The '_' will be replaced by space in the program.
	
</LI>
</UL>
</DD>
</DL>

<P>
</LI>
<LI>constellationsart.fab

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Contains the constellation art info : i.e. for drawing of mythologic figures.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ascii file, fields separated by SPACE, end of line is CR ('<IMG
 WIDTH="13" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\backslash$">n')
</DD>
<DT><STRONG>line example :</STRONG></DT>
<DD>Lep lepus_m 104 57 24305 90 29 24845 33 42 27288
</DD>
<DT><STRONG>line format :</STRONG></DT>
<DD>ConstRef TextureFile x1 y1 HP1 x2 y2 HP2 x3 y3 HP3
	
<UL>
<LI>ConstRef : Short international name abreviation in 3 characters, first char in Capital letter
</LI>
<LI>TextureFile : Texture file name without the extension (no space character). The texture file has to be in the stellarium texture directory.
</LI>
<LI>x1 y1 hp1 (respectively 2 and 3) : the x and y position of the matching star
	  with hipparcos number hp1 (respectively 2 and 3) on the texture image. The
	  values are in pixels with the (0,0) in the upper left corner.
	
</LI>
</UL>
</DD>
<DT><STRONG>note :</STRONG></DT>
<DD>the associated texture file must be in png format and have no alpha channel. The drawing background must be black.
</DD>
</DL>

<P>
</LI>
<LI>constellationship.fab

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Contains the constellations lines shape.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ascii file, fields separated by SPACE, end of line is CR ('<IMG
 WIDTH="13" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\backslash$">n')
</DD>
<DT><STRONG>line example :</STRONG></DT>
<DD>And ANDROMEDE ANDROMEDA 3  9640 5447 5447 4436 4436 3881
</DD>
<DT><STRONG>line format :</STRONG></DT>
<DD>ConstRef ConstCommonName ConstInternationnalName NumberOfSegments seg11 seg12 seg21 seg22 etc...
	
<UL>
<LI>ConstRef : Short international name abreviation in 3 characters, first char
	  in Capital letter
</LI>
<LI>ConstCommonName : Commonly used name (currently in french!)
</LI>
<LI>ConstInternationnalName : The latin internationnal name.
</LI>
<LI>NumberOfSegments : the number of segments in the shape.
</LI>
<LI>segx1 segx2 : the hipparcos number of the stars 1 and 2 joined to form the xth segment.
	
</LI>
</UL>
</DD>
</DL>

<P>
</LI>
<LI>courierfont.txt and spacefont.txt

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>contains the characters position on the font texture.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ascii file, fields separated by SPACE, end of line is CR ('<IMG
 WIDTH="13" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\backslash$">n')
</DD>
<DT><STRONG>first line format :</STRONG></DT>
<DD>CourierFont LineSize 21
	
<UL>
<LI>Font Name
</LI>
<LI>LineSize s : s is the maximum character height.
	
</LI>
</UL>
</DD>
<DT><STRONG>other lines example :</STRONG></DT>
<DD>065 02 2 14 21 0
</DD>
<DT><STRONG>other lines format :</STRONG></DT>
<DD>ascii# x y w h s
	
<UL>
<LI>ascii# : ascii number of the character
</LI>
<LI>x y : position of the upper left corner of the character in the font texture (in pixel).
</LI>
<LI>w h : width and height of the character on the texture
</LI>
<LI>s : space to add at the end of the char when displaying.
	
</LI>
</UL>
</DD>
</DL>

<P>
</LI>
<LI>messier.fab

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Contains the nebula list (not only messier)
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ascii file, fields separated by SPACE, end of line is CR ('<IMG
 WIDTH="13" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img2.png"
 ALT="$\backslash$">n')
</DD>
<DT><STRONG>line example :</STRONG></DT>
<DD>1952 RS 05 34.5 +22 +01 8.2 06.0 0 M1_-_Crab_Nebula m1
</DD>
<DT><STRONG>line format :</STRONG></DT>
<DD>NGCnumber NebulaType hh min.mm deg min.mm mag size texRotation Name TexName
	
<UL>
<LI>NGCnumber : NGC catalog number
</LI>
<LI>NebulaType : TODO and change..
</LI>
<LI>hh min.mm : Right ascention hour and minutes and tenth of minutes
</LI>
<LI>deg min.mm : Declinaison in degree min and tenth of minutes
</LI>
<LI>mag : magnitude
</LI>
<LI>size : angular size in arcminute
</LI>
<LI>Name : Nebula name with spaces replaced by '_'
</LI>
<LI>TexName : texture file name. png file without alpha chanel.
	
</LI>
</UL>
</DD>
</DL>

<P>
</LI>
<LI>name.txt
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>More info about stars, not used anymore.
</DD>
</DL>

<P>
</LI>
<LI>ssystem.ini

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Solar system bodies informations.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ini file. One section per body.
</DD>
<DT><STRONG>Section example :</STRONG></DT>
<DD><PRE>
[io]                    // Section name, has to be unique
name = Io               // Body name
parent = Jupiter        // Body parent
radius = 1821.          // Radius in km
halo = true             // Do we have to draw a small halo like a star?
color = 1.,1.,1.        // Halo color
tex_map = io            // Texture map file without extension (has to .png)
tex_halo = star16x16    // Halo texture file
lightning = true        // Compute shadow on it
albedo = 0.61           // Body albedo (how it reflects light) range 0 to 1
rot_rotation_offset = 220.8   // For texture alignment
rot_obliquity = 0.0           // Planet Obliquity (rotation axe inclination
                              // relative to the orbit plane)
coord_func = ell_orbit        // Define the coordinate computation funcion :
                              // can be a custom func or "ell_orbit"
orbit_Epoch = 2443000.00038375// Ell_orbit calculation parameter
orbit_Period = 1.769138       //       "    "
orbit_SemiMajorAxis = 421600  //       "    "
orbit_Eccentricity = 0.0041   //       "    "
orbit_Inclination = 0.040     //       "    "
orbit_AscendingNode = 312.981 //       "    "
orbit_LongOfPericenter = 97.73//       "    "
orbit_MeanLongitude = 106.724 //       "    "
</PRE>
</DD>
</DL>

<P>
</LI>
<LI>landscape.ini

<P>
<DL>
<DT><STRONG>desc :</STRONG></DT>
<DD>Landscape skins descriptions.
</DD>
<DT><STRONG>type :</STRONG></DT>
<DD>ini file. One section per landscape.
</DD>
<DT><STRONG>note :</STRONG></DT>
<DD>There can be 2 landscape types, the ones made from a fisheye picture and the ones made from many smaller textures. The fisheye textures must be centered on the zenith, north on the bottom.
</DD>
<DT><STRONG>Section example for a fisheye :</STRONG></DT>
<DD><PRE>
[palm]                              // Section name
name = Palm                         // Landscape name
type = fisheye                      // Type = fisheye
maptex = landscapes/horizonalpha512 // Fisheye texture file name
texturefov = 210                    // Field of View covered by the texture
                                    // (180 = half dome, 360 = full sphere)
author = Gérard_Dupontd             // Author name
</PRE>
</DD>
</DL>

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION00060000000000000000">
About this document ...</A>
</H1>
 <STRONG><B>Stellarium Developer guide</B> 
<BR>
v 0.2</STRONG><P>
This document was generated using the
<A HREF="http://www.latex2html.org/"><STRONG>LaTeX</STRONG>2<tt>HTML</tt></A> translator Version 2002-2-1 (1.70)
<P>
Copyright &#169; 1993, 1994, 1995, 1996,
<A HREF="http://cbl.leeds.ac.uk/nikos/personal.html">Nikos Drakos</A>, 
Computer Based Learning Unit, University of Leeds.
<BR>
Copyright &#169; 1997, 1998, 1999,
<A HREF="http://www.maths.mq.edu.au/~ross/">Ross Moore</A>, 
Mathematics Department, Macquarie University, Sydney.
<P>
The command line arguments were: <BR>
 <STRONG>latex2html</STRONG> <TT>-split 0 -nonavigation developer_guide.tex</TT>
<P>
The translation was initiated by fabien on 2003-12-19
<BR><HR>
<ADDRESS>
fabien
2003-12-19
</ADDRESS>
</BODY>
</HTML>
