version: '{branch}-{build}'

# branches to build
branches:
  # whitelist
  only:
    - appveyor-experiments

# Do not build feature branch with open Pull Requests
skip_branch_with_pr: true
# build Configuration
configuration: Release
# set clone depth
clone_depth: 5
# clone directory
clone_folder: c:\stellarium
# environment variables
environment:
  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    platform: x64
    qtver: 5.9
    qtbin: msvc2015_64
    msvcname: Visual Studio 14 2015 Win64 
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    platform: Win32
    qtver: 5.9
    qtbin: msvc2015
    msvcname: Visual Studio 14 2015

before_build:
- cmd: >-
    mkdir stellarium-%qtver%-%qtbin%
    
    set INNSPATH=C:\Program Files (x86)\Inno Setup 5
    
    set PATH=C:\Qt\%qtver%\%qtbin%\bin;%INNSPATH%;%PATH%

    cd c:\stellarium

    mkdir build-%qtver%-%qtbin% && cd build-%qtver%-%qtbin%

    cmake -DCMAKE_INSTALL_PREFIX=c:\stellarium-%qtver%-%qtbin% -G "%msvcname%" ..

build:
  project: c:\stellarium\build-%qtver%-%qtbin%\Stellarium.sln
  parallel: true
  verbosity: minimal
  
after_build:
- cmd: >-
    cmake --build c:\stellarium\build-%qtver%-%qtbin%\ --config %configuration% --target install 

    cmake --build c:\stellarium\build-%qtver%-%qtbin%\ --config %configuration% --target stellarium-installer

artifacts:
  - path: installer\*.exe
    name: installer

notifications:
- provider: Email
  to:
  - mcardinot@gmail.com
  - alex.v.wolf@gmail.com
  on_build_success: false
  on_build_failure: true
  on_build_status_changed: true
